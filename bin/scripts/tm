#!/bin/bash 

# dotfiles - Personal configuration files and scripts
# Copyright (C) 2025  Zach Podbielniak
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with this program.  If not, see <https://www.gnu.org/licenses/>.

# Main tmux session
# supports nested tmux
#
# for nesting see `tn`
set -euo pipefail 

ses_name="main"
tmux_main=$(tmux ls | grep -P "^${ses_name}" || true)

if [[ "${tmux_main}" == "" ]]
then 
    tmux -2 new-ses -d -t ${ses_name}
        
    # Create scratch and notes windows
    tmux rename-window -t ${ses_name} "scratch"
    tmux new-window -d -t ${ses_name} -n "notes"

    # Setup scratch
    tmux select-window -t "scratch"
    tmux split-window -t ${ses_name} -h 
    type gurk &>/dev/null && tmux send-keys -t ${ses_name} "gurk" Enter
    tmux split-window -t ${ses_name} -v
    tmux send-keys -t ${ses_name} "ncmpcpp" Enter
    tmux select-pane -t 0

    # Setup notes
    tmux select-window -t "notes"
    tmux send-keys -t ${ses_name} "cdn" Enter "v" Enter

    # Switch back to scratch
    tmux select-window -t "scratch"
fi

tmux set prefix C-s
exec tmux -2 a -t ${ses_name}

