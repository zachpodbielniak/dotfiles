#!/bin/bash 
# Main tmux session
# supports nested tmux
#
# for nesting see `tn`
set -euo pipefail 

ses_name="main"
tmux_main=$(tmux ls | grep -P "^${ses_name}" || true)

if [[ "${tmux_main}" == "" ]]
then 
    tmux -2 new-ses -d -t ${ses_name}
        
    # Create scratch and notes windows
    tmux rename-window -t ${ses_name} "scratch"
    tmux new-window -d -t ${ses_name} -n "notes"

    # Setup scratch
    tmux select-window -t "scratch"
    tmux split-window -t ${ses_name} -h 
    [[ $(type gurk &>/dev/null) -eq 0 ]] && tmux send-keys -t ${ses_name} "gurk" Enter
    tmux split-window -t ${ses_name} -v
    tmux send-keys -t ${ses_name} "ncmpcpp" Enter
    tmux select-pane -t 0

    # Setup notes
    tmux select-window -t "notes"
    tmux send-keys -t ${ses_name} "cdn" Enter "v" Enter

    # Switch back to scratch
    tmux select-window -t "scratch"
fi

tmux set prefix C-s
exec tmux -2 a -t ${ses_name}

