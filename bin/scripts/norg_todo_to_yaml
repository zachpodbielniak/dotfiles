#!/bin/bash 

# dotfiles - Personal configuration files and scripts
# Copyright (C) 2025  Zach Podbielniak
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with this program.  If not, see <https://www.gnu.org/licenses/>.

set -euo pipefail 

# if [[ $# -lt 1 ]]
# then 
#     echo "Usage: $(basename $0) < <file>"
#     exit 1
# fi

KEY="todo"
CATEGORY=""

echo "---"
echo "${KEY}: "
while read -r line 
do 
    # look for section heading
    if [[ "${line}" =~ \*\*\  ]]
    then 
        CATEGORY="$(sed 's/\*//g' <<< "${line}" | xargs)"
    fi

    # look for bullet points
    if [[ "${line}" =~ -\ \( ]]
    then 
        task=$(awk -F')' '{ printf "%s\n", $2}' <<< "${line}" | awk -F'(' '{ printf "%s\n", $1 }' | sed s'/\*//g' | xargs)
        status=$(awk -F'(' '{ printf "%s\n", $2}' <<< "${line}" | awk -F')' '{ printf "%s\n", $1 }' | xargs)
        due=$(awk -F')' '{ printf "%s\n", $2}' <<< "${line}" | awk -F'(' '{ printf "%s\n", $2 }' | xargs)

        # echo "${task}"
        # echo "${status}"
        # echo "${due}"

        case "${status}" in 
            ' ')
                real_status="not-started"
                ;;
            'x')
                real_status="done"
                ;;
            '?')
                real_status="ambiguous"
                ;;
            '_')
                real_status="cancelled"
                ;;
            "=")
                real_status="on-hold"
                ;;
            '!')
                real_status="important"
                ;;
            '-')
                real_status="pending"
                ;;
            '+')
                real_status="recurring"
                ;;
            *)
                real_status="not-started"
                ;;
        esac
        # echo "${status}"

        printf "  - task: \"${task}\"\n    category: \"${CATEGORY}\"\n    due: \"${due}\"\n    status: \"${status}\"\n    real_status: \"${real_status}\"\n"
    fi

done
   # - ( ) not started 
   # - (x) done 
   # - (?) ambiguous 
   # - (_) cancelled
   # - (=) on-hold
   # - (!) important
   # - (-) pending
   # - (+) recurring
