#!/bin/bash

# dotfiles - Personal configuration files and scripts
# Copyright (C) 2025  Zach Podbielniak
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with this program.  If not, see <https://www.gnu.org/licenses/>.

# set -euxo pipefail

data=""
timestamp=$(date +'%Y-%m-%d-%H:%M:%S')
annotation=""
do_vipe=0
output=""

INBOX_DIR="$HOME/Documents/notes/00_inbox"
OUTPUT_FILE="${INBOX_DIR}/$(today).md"

if [[ $# -ge 1 ]]; then 
    if [[ "-v" == "$1" ]]; then 
        do_vipe=1 
    else
        annotation="$1"
    fi
fi

while IFS= read -r line 
do 
    data="$data\n$line"
done

if [[ "" != "$annotation" || 1 -eq $do_vipe ]]; then
    output=$(echo -e "* data from $timestamp\n- $annotation\n@code text\n$data\n\n@end\n")
else 
    output=$(echo -e "* data from $timestamp\n@code text\n$data\n\n@end\n")
fi

touch "${OUTPUT_FILE}"

if [[ 1 -eq $do_vipe ]]; then
    echo -e "$output\n\n" | vipe >> "${OUTPUT_FILE}"
else 
    echo -e "$output\n\n" >> "${OUTPUT_FILE}"
fi

echo "Wrote output to: ${OUTPUT_FILE}" 1>&2

