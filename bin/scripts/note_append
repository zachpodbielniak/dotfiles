#!/bin/bash
# set -euxo pipefail

data=""
timestamp=$(date +'%Y-%m-%d-%H:%M:%S')
annotation=""
do_vipe=0
output=""

INBOX_DIR="$HOME/Documents/notes/00_inbox"
OUTPUT_FILE="${INBOX_DIR}/$(today).norg"

if [[ $# -ge 1 ]]; then 
    if [[ "-v" == "$1" ]]; then 
        do_vipe=1 
    else
        annotation="$1"
    fi
fi

while IFS= read -r line 
do 
    data="$data\n$line"
done

if [[ "" != "$annotation" || 1 -eq $do_vipe ]]; then
    output=$(echo -e "* data from $timestamp\n- $annotation\n@code text\n$data\n\n@end\n")
else 
    output=$(echo -e "* data from $timestamp\n@code text\n$data\n\n@end\n")
fi

touch "${OUTPUT_FILE}"

if [[ 1 -eq $do_vipe ]]; then
    echo -e "$output\n\n" | vipe >> "${OUTPUT_FILE}"
else 
    echo -e "$output\n\n" >> "${OUTPUT_FILE}"
fi

echo "Wrote output to: ${OUTPUT_FILE}" 1>&2

