#!/bin/bash 

arg_type=""
arg_category=""
args_for_sbi=()

print_help() {
    echo -e "Usage: $(basename ${0}) <args>"
    echo -e "  -h,--help\t\tprint this message"
    echo -e "  -t,--file-type\ttype of file ('*.html', '*.md', etc.)"
    echo -e "  -c,--category\tcategory (sub dirs are appended)"
}

while [[ $# -gt 0 ]]
do 
    case "${1}" in 
        -h|--help)
            print_help
            exit 0 
            ;; 
        -t|--file-type)
            arg_type="${2}"
            shift 
            ;;
        -c|--category)
            arg_category="${2}"
            shift 
            ;;
        *)
            args_for_sbi+=("${1}")
            ;;
    esac
    shift
done

files=$(find . -type f -name "${arg_type}")

while read -r file
do 
    dir="$(dirname "${file}")"
    if [[ "" != "${arg_category}" ]]
    then
        cmd="sbi ${args_for_sbi[@]} --category "${arg_category}/${dir:2}" "${file}""
        echo "running ${cmd}"
        bash -c "${cmd}" &
    else 
        cmd="sbi ${args_for_sbi[@]} --category "${dir:2}" "${file}""
        echo "running ${cmd}"
        bash -c "${cmd}" &
        # sbi ${args_for_sbi[@]} --category "${dir:2}" "${file}"
    fi
done <<< "${files}"

wait
echo "done"


