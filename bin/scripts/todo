#!/bin/bash 
set -euo pipefail

notes_dir="${HOME}/Documents/notes"
todo_file="${notes_dir}/02_areas/todo.norg"
operation="list"

filter_date=""
yaml_lookup=""

print_help() {
    echo -e "Usage: $(basename ${0}) <args>"
    echo -e "  -h,--help\tprint this message"
    echo -e "  -e,--edit\tedit the todo file"
    echo -e "  -a,--add\tadd an item todo"
    echo -e "  -d,--date\tdate to search or add task for"
    echo -e "  -y,--yaml\tprint in yaml"
}


if [[ ! -f "${todo_file}" ]]
then 
    touch "${todo_file}"
fi


while [[ ${#} -gt 0 ]]
do 
    case "${1}" in 
        -h|--help)
            print_help
            exit 0
            ;;
        -e|--edit)
            operation="edit"
            ;;
        -y|--yaml)
            operation="yaml"
            ;;
        -d|--date)
            shift
            filter_date="${1}"
            ;;
    esac
    shift 
done


# yq_name_filter=".bookmarks[] | select(.group == \"${group}\").name"

case "${operation}" in 
    "list")
        if [[ "${filter_date}" != "" ]]
        then 
            yaml_lookup=".todo.[] | select(.due == \"${filter_date}\").task"
        else
            yaml_lookup=".todo.[].task"
        fi
        yq "${yaml_lookup}" < <(norg_todo_to_yaml < "${todo_file}")
        ;;
    "yaml")
        yq < <(norg_todo_to_yaml < "${todo_file}")
        ;;
    "edit")
        cd "$(dirname "${todo_file}")"
        exec nvim "${todo_file}"
        ;;
esac

