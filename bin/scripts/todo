#!/bin/bash 

# dotfiles - Personal configuration files and scripts
# Copyright (C) 2025  Zach Podbielniak
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with this program.  If not, see <https://www.gnu.org/licenses/>.

set -euo pipefail

notes_dir="${HOME}/Documents/notes"
todo_file="${notes_dir}/02_areas/todo.md"
operation="list"

filter_date=""
yaml_lookup=""

print_help() {
    echo -e "Usage: $(basename ${0}) <args>"
    echo -e "  -h,--help\tprint this message"
    echo -e "  -e,--edit\tedit the todo file"
    echo -e "  -a,--add\tadd an item todo"
    echo -e "  -d,--date\tdate to search or add task for"
    echo -e "  -y,--yaml\tprint in yaml"
}


if [[ ! -f "${todo_file}" ]]
then 
    touch "${todo_file}"
fi


while [[ ${#} -gt 0 ]]
do 
    case "${1}" in 
        -h|--help)
            print_help
            exit 0
            ;;
        -e|--edit)
            operation="edit"
            ;;
        -y|--yaml)
            operation="yaml"
            ;;
        -d|--date)
            shift
            filter_date="${1}"
            ;;
    esac
    shift 
done


# yq_name_filter=".bookmarks[] | select(.group == \"${group}\").name"

case "${operation}" in 
    "list")
        if [[ "${filter_date}" != "" ]]
        then 
            yaml_lookup=".todo.[] | select(.due == \"${filter_date}\").task"
        else
            yaml_lookup=".todo.[].task"
        fi
        yq "${yaml_lookup}" < <(md_todo_to_yaml < "${todo_file}")
        ;;
    "yaml")
        yq < <(md_todo_to_yaml < "${todo_file}")
        ;;
    "edit")
        cd "$(dirname "${todo_file}")"
        exec nvim "${todo_file}"
        ;;
esac

