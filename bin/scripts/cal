#!/bin/bash 

# dotfiles - Personal configuration files and scripts
# Copyright (C) 2025  Zach Podbielniak
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with this program.  If not, see <https://www.gnu.org/licenses/>.

set -euo pipefail

NOTES_DIR="${HOME}/Documents/notes"
OPERATION=""
CMD_OPTS=""

# if no args default to as if "--month" was passed
if [[ $# -eq 0 ]]
then 
    OPERATION="--month"
else 
    OPERATION="${1}"
fi


print_help() {
    echo -e "Usage:\n"
    echo -e "$(basename ${0}) <single_argument>"
    echo -e "  -h,--help\tprint this message"
    echo -e "  -m,--month\tstart in month mode (default)"
    echo -e "  -y,--year\tstart in year mode"
    echo -e "  -w,--week\tstart in week mode"
    echo -e "  -d,--day\tstart in day mode"
    echo -e "  -D,--days\tstart in days mode"
    echo -e "  -c,--clock\tstart in clock mode"
    echo -e "  -a,--event\tstart in event mode"
    echo -e "  -a,--agenda\tstart in event mode"
    echo -e "  -s,--system\tcall-through to system 'cal' command"
}


# parse the operation 
if [[ "${OPERATION}" == "-h" ]] || [[ "${OPERATION}" == "--help" ]]
then 
    print_help
    exit 0
elif [[ "${OPERATION}" == "-m" ]] || [[ "${OPERATION}" == "--month" ]]
then
    CMD_OPTS=" -view=month "
elif [[ "${OPERATION}" == "-y" ]] || [[ "${OPERATION}" == "--year" ]]
then
    CMD_OPTS=" -view=year "
elif [[ "${OPERATION}" == "-w" ]] || [[ "${OPERATION}" == "--week" ]]
then
    CMD_OPTS=" -view=week "
elif [[ "${OPERATION}" == "-d" ]] || [[ "${OPERATION}" == "--day" ]]
then
    CMD_OPTS=" -view=day "
elif [[ "${OPERATION}" == "-D" ]] || [[ "${OPERATION}" == "--days" ]]
then
    CMD_OPTS=" -view=days "
elif [[ "${OPERATION}" == "-c" ]] || [[ "${OPERATION}" == "--clock" ]]
then
    CMD_OPTS=" -view=clock "
elif [[ "${OPERATION}" == "-e" ]] || [[ "${OPERATION}" == "--event" ]]
then
    CMD_OPTS=" -view=event "
elif [[ "${OPERATION}" == "-a" ]] || [[ "${OPERATION}" == "--agenda" ]]
then
    CMD_OPTS=" -view=agenda "
elif [[ "${OPERATION}" == "-s" ]] || [[ "${OPERATION}" == "--system" ]]
then
    shift
    exec /usr/bin/cal $@
fi


# call the neovim calendar
cd "${NOTES_DIR}"
exec nvim +"Calendar${CMD_OPTS}<CR>"

