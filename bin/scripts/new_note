#!/bin/bash 
set -euo pipefail
shopt -s extglob

notes_path="$HOME/Documents/notes"
para_path=""
today="$(today)"
full_path=""

# If less less than 1 default to date in inbox
if [[ $# -lt 1 ]]
then 
    full_path="${notes_path}/00_inbox/$today.norg"
    if [[ ! -f "$full_path" ]]; then template_daily > "$full_path"; fi
    cd "${notes_path}"
    exec nvim "${full_path}"
fi

# If less than 2 default to inbox but with name
if [[ $# -lt 2 ]]
then 
    full_path="${notes_path}/00_inbox/$1.norg"
    cd "${notes_path}"
    exec nvim "${full_path}"
fi


nloc="$1"
nname="$2"
readarray -d/ path_split <<< "$nloc"


case "${path_split[0]/\//}" in 
    # archives must match exactly and be first
    arc*)
        para_path="04_archives"
        ;;

    # _inbox
    i*) para_path="00_inbox"
        ;;
        
    # projects
    p*)
        para_path="01_projects"
        ;;

    # areas
    a*)
        para_path="02_areas"
        ;;

    # resources
    r*)
        para_path="03_resources"
        ;;

esac
new_note="$para_path/"

for subdir in "${path_split[@]:1}"
do 
    new_note="${new_note}${subdir}"
done

# Remove whitespace with xargs trick - https://stackoverflow.com/questions/369758/how-to-trim-whitespace-from-a-bash-variable
new_note="$(echo ${new_note} | xargs echo)/${nname}.norg"

full_path="${notes_path}/${new_note}"
echo -e "New note can be found here:\n${full_path}"

mkdir -p "$(dirname ${full_path})"
# No need to touch it, since when we save it will be written
# touch "${full_path}"

cd "${notes_path}"
exec nvim "${full_path}"

