#!/bin/bash 
set -euo pipefail

notes_dir="${HOME}/Documents/notes"
vim_anywhere_log="${notes_dir}/03_resources/vim-anywhere/$(today).norg"
mode="fresh"

print_help() {
    echo -e "Usage: $(basename "${0}") <args>"
    echo -e "  -h,--help\tprint this message"
    echo -e "  -p,--paste\tread from clipboard first"
}

if [[ ! -d "$(dirname "${vim_anywhere_log}")" ]]
then 
    mkdir -p "$(dirname "${vim_anywhere_log}")"
fi

if [[ ! -f "${vim_anywhere_log}" ]]
then 
    touch "${vim_anywhere_log}"
fi


while [[ $# -gt 0 ]]
do 
    case "${1}" in 
        -h|--help)
            print_help
            exit 0
            ;;
        -p|--paste)
            mode="paste"
            ;;
    esac
    shift
done


case "${mode}" in 
    "fresh")
        exec vipe | tee -a "${vim_anywhere_log}" | wl-copy
        ;;
    "paste")
        exec vipe < <(wl-paste) | tee -a "${vim_anywhere_log}" | wl-copy
        ;;
esac

