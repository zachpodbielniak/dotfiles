#!/bin/bash
# dotfiles - Personal configuration files and scripts
# Copyright (C) 2024  Zach Podbielniak
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with this program.  If not, see <https://www.gnu.org/licenses/>.

set -euo pipefail

usage () {
	cat << 'EOF'
extract_urls - Extract all URLs from text

USAGE:
	extract_urls [OPTIONS]

OPTIONS:
	-h, --help          Show this help message
	--license           Show license information
	--https-only        Only HTTPS URLs
	--unique            Deduplicate

EXAMPLES:
	cat webpage.html | extract_urls
	cat file.txt | extract_urls --https-only
	cat data.txt | extract_urls --unique

EOF
}

https_only=false
unique_only=false

while [[ $# -gt 0 ]]; do
	case "${1}" in
		-h|--help) usage; exit 0 ;;
		--license) echo "AGPLv3"; exit 0 ;;
		--https-only) https_only=true; shift ;;
		--unique) unique_only=true; shift ;;
		*) echo "Error: unexpected argument '$1'" >&2; exit 1 ;;
	esac
done

# URL regex pattern
if [[ "$https_only" == true ]]; then
	pattern='https://[a-zA-Z0-9._/#@!$&'"'"'()*+,;:=%-]*'
else
	pattern='https\?://[a-zA-Z0-9._/#@!$&'"'"'()*+,;:=%-]*'
fi

if [[ "$unique_only" == true ]]; then
	grep -oE "$pattern" | sort -u
else
	grep -oE "$pattern"
fi
