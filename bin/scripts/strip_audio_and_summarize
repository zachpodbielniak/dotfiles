#!/bin/bash 

# dotfiles - Personal configuration files and scripts
# Copyright (C) 2025  Zach Podbielniak
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with this program.  If not, see <https://www.gnu.org/licenses/>.


input=""
output=""

if [[ $# -lt 1 ]]
then 
    echo "use this tool correctly:"
    echo "  ${0} <input_file> [output_file]"
fi

input="${1}"

if [[ $# -ge 2 ]]
then 
    output="${2}"
else 
    output="${input}.ogg"
fi

# strip audio from a video
strip_audio "${input}" "${output}"

# txt output stored in ${output}.txt
transcribe_audio "${output}"

# get a summary in markdown
ai_summary_as_markdown < "${output}.txt" > "${output}.md"

# place markdown copy on the clipboard
wl-copy < "${output}.md"

printf \
    "%s\n%s\n%s\n%s\n" \
    "audio file: ${output}" \
    "transcription: ${output}.txt" \
    "summary: ${output}.md" \
    "clipboard: summary in markdown"

