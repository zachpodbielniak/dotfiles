# Theme
source ~/.config/neomutt/catppuccin-mocha.muttrc

# Paths
set folder           = "~/.local/share/mail"
set header_cache     = "~/.cache/neomutt/headers"
set message_cachedir = "~/.cache/neomutt/bodies"
set mailcap_path     = "~/.config/neomutt/mailcap"

# HTML email handling - auto-convert HTML to text via mailcap
auto_view text/html
alternative_order text/plain text/enriched text/html

# Editor (you'll want nvim)
set editor           = "nvim"

# Basic behavior
set wait_key         = no
set mbox_type        = Maildir
set timeout          = 3
set mail_check       = 0
set delete
set quit
unset confirmappend
unset mark_old

# Sorting
set sort             = threads
set sort_aux         = reverse-last-date-received

# Index format with smart date display
# Shows time for today, day for this week, date for this month, month/year for older
set index_format     = "%4C %Z %<[y?%<[m?%<[d?%[%H:%M]&%[%a %d]>&%[%b %d]>&%[%m/%y]> %-20.20L  %s"
set date_format      = "%d %b %Y"

# Message status is shown via %Z flag and colored by the theme
# The color definitions make different states visually distinct

# Pager
set pager_index_lines = 10
set pager_context     = 3
set pager_stop
set tilde
unset markers

# Sidebar with Unicode folder indicators
set sidebar_visible   = yes
set sidebar_width     = 30
set sidebar_format    = "%D%?F? [%F]?%* %?N?%N/?%S"
set sidebar_short_path = yes
set sidebar_delim_chars = "/."
set sidebar_folder_indent = yes
set sidebar_indent_string = "  "
bind index,pager B sidebar-toggle-visible
bind index,pager \Cp sidebar-prev
bind index,pager \Cn sidebar-next
bind index,pager \Co sidebar-open

# URL extraction - pipe to urlscan for clickable links
macro index,pager \cy "<pipe-message>urlscan<enter>" "extract URLs with urlscan"

# Render HTML email as markdown with glow
macro index,pager \cx "<pipe-message>pandoc -f html -t markdown 2>/dev/null | glow - --tui<enter>" "render as markdown with glow"

# Quick archiving
macro index,pager A "<save-message>+Archive<enter>" "archive message"

# Save email to second brain (interactive PARA selection via fsbi)
macro index,pager \es "<pipe-message>email_to_notes<enter>" "save email to notes"

# Sync changes AND check for new mail
macro index,pager R "<sync-mailbox><imap-fetch-mail>" "sync and refresh"

# Vi-like keybindings
bind index j next-entry
bind index k previous-entry
bind index g noop
bind index gg first-entry
bind index G last-entry
bind pager j next-line
bind pager k previous-line
bind pager g noop
bind pager gg top
bind pager G bottom

# Load account
source ~/.config/neomutt/accounts/proton
